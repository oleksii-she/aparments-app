import{_ as L,ac as j,a as F,ae as z,b as y,u as M,r as I,q as S,c as C,o as n,d as i,f as e,D as c,B as m,h as A,x as T,e as w,t as x,v as P,g as H,af as J,ag as K,l as O,ah as Q,ai as R,aj as W,ak as X,p as Y,j as Z,A as ee,m as N}from"./index-4ca0792c.js";import{A as te}from"./AddRating-3a4aa235.js";const g=v=>(Y("data-v-f9175207"),v=v(),Z(),v),q=N+"#icon-edit",B=N+"#icon-confirm",se={class:"container user-page"},ae={class:"home-page__wrapper"},ne={class:"user-wrapper"},oe={key:0,class:"user"},re={class:"wrapper"},ie={key:0,class:"user__text-wrapper"},ce={class:"user__text"},le=g(()=>e("svg",{class:"btn-edit__icon"},[e("use",{"xlink:href":q})],-1)),_e=[le],ue={key:1,class:"user__text-wrapper"},de={class:"user__text"},pe=["value"],he=g(()=>e("svg",{class:"btn-edit__icon"},[e("use",{"xlink:href":B})],-1)),me=[he],ge={class:"user__text-wrapper"},ve={class:"user__text"},fe={class:"wrapper"},ye={key:0,class:"user__text-wrapper"},xe={key:0,class:"user__text"},ke={key:1,class:"user__text"},we=g(()=>e("svg",{class:"btn-edit__icon"},[e("use",{"xlink:href":q})],-1)),Ue=[we],be={key:1,class:"user__text-wrapper"},Ve={class:"user__text"},Ie=["value"],Se=g(()=>e("svg",{class:"btn-edit__icon"},[e("use",{"xlink:href":B})],-1)),Ce=[Se],Ae={key:1,class:"user"},Pe={class:"wrapper"},Re={class:"user__text-wrapper"},Ne={class:"user__text"},qe={class:"user__text-wrapper"},Be={class:"user__text"},De={class:"user__text-wrapper"},Ee={class:"user__text"},$e={key:2,class:"user-rating-box"},Ge=g(()=>e("h3",null,"User rating",-1)),Le={key:3,class:"user-rating-box"},je=g(()=>e("h3",null,"User rating",-1)),Fe={__name:"UserPage",setup(v){const k=j(),D=F(),E=9,l=z(),p=y(parseInt(k.query.page)||1),_=M(),$=ee({position:"top"}),u=I({name:!1,phone:!1}),r=I({name:"",phone:""}),h=y({}),d=y(null),f=y(!1);S(async()=>{const{id:s}=_;D.push({query:{...k.query,page:p.value}});const t=k.params.id;if(t&&s!==t){d.value=t;const o=await l.fetchGetUser(t);await l.fetchUserApartments(t,p.value),o.usersRatings.find(G=>G.user===s)&&(f.value=!0);const a=Math.round(o.userRating);h.value={name:o.name,phone:o.phone,email:o.email,rating:a}}else if(l.fetchUserApartments(s,p.value),r.name=_.name,_.phone){const o=R(_.phone);r.phone=o}}),S(async()=>{try{f.value&&(await l.fetchGetUser(d.value),console.log("fetchGetUser"))}catch(s){console.log(s.message)}});const U=s=>{if(s.target.name==="name"&&(r.name=s.target.value),s.target.name==="phone"){const t=s.target.value;/^\+38\(\d{3}\)\d{3}-\d{2}-\d{2}$/.test(t)&&(r.phone=s.target.value)}},b=async()=>{try{const s=O(r.phone),t=r.name,o={phone:s,name:t};await _.fetchUpdateUser(o),u.phone=!1,u.name=!1}catch(s){if(u.phone=!1,u.name=!1,s.request.status===400)return r.phone=_.phone,$.warning(s.request.response);console.log(s.message)}};return(s,t)=>{const o=C("URating"),V=C("ULoader");return n(),i("main",null,[e("section",null,[e("div",se,[e("div",ae,[e("div",ne,[!d.value||c(_).id===d.value?(n(),i("div",oe,[e("div",re,[u.name?(n(),i("div",ue,[e("label",de,[A(" і’мя: "),e("input",{class:"user__input-rename",name:"name",value:r.name,onChange:U},null,40,pe)]),e("button",{onClick:b,class:"btn-edit"},me)])):(n(),i("div",ie,[e("p",ce,"і’мя: "+m(r.name),1),e("button",{onClick:t[0]||(t[0]=a=>u.name=!0),class:"btn-edit"},_e)]))]),e("div",ge,[e("p",ve,"E-mail: "+m(c(_).email),1)]),e("div",fe,[u.phone?(n(),i("div",be,[e("label",Ve,[A(" Телефон: "),T(e("input",{ref:"phoneInput",class:"user__input-rename",type:"tel",name:"phone",value:r.phone,onChange:U},null,40,Ie),[[c(Q),{mask:"+38(0##)###-##-##"}]])]),e("button",{onClick:b,class:"btn-edit"},Ce)])):(n(),i("div",ye,[r.phone?(n(),i("p",xe,"Телефон: "+m(r.phone),1)):(n(),i("p",ke,"Телефон: +38(000)000-00-00")),e("button",{onClick:t[1]||(t[1]=a=>u.phone=!0),class:"btn-edit"},Ue)]))])])):(n(),i("div",Ae,[e("div",Pe,[e("div",Re,[e("p",Ne,"Name: "+m(h.value.name),1)]),e("div",qe,[e("p",Be,"Email: "+m(h.value.email),1)]),e("div",De,[e("p",Ee,"Phone: "+m(c(R)(h.value.phone)),1)])])])),!d.value||c(_).id===d.value?(n(),i("div",$e,[Ge,w(o,{width:50,height:50,rating:h.value.rating},null,8,["rating"])])):(n(),i("div",Le,[je,f.value?(n(),x(o,{key:0,width:50,height:50,rating:h.value.rating},null,8,["rating"])):(n(),x(te,{key:1,width:50,height:50,"onUpdate:isVote":t[2]||(t[2]=a=>f.value=a),ratingVote:c(W),id:d.value},null,8,["ratingVote","id"]))]))]),e("div",null,[c(l).loading?(n(),x(V,{key:0,loading:!0})):P("",!0),w(J,{apartments:c(l).apartments},{apartment:H(a=>[w(X,{id:a.apartment._id,coverImage:a.apartment.coverImage,description:a.apartment.description,price:a.apartment.price,longStayPrice:a.apartment.longStayPrice,country:a.apartment.country,rating:a.apartment.rating},null,8,["id","coverImage","description","price","longStayPrice","country","rating"])]),_:1},8,["apartments"])])]),c(l).totalPosts>9&&!c(l).loading?(n(),x(K,{key:0,class:"paginate",modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=a=>p.value=a),perPage:E,rangeSize:1,"active-color":"#DCEDFF","onUpdate:value":t[4]||(t[4]=a=>p.value=a),totalPost:c(l).totalPosts},null,8,["modelValue","totalPost"])):P("",!0)])])])}}},Te=L(Fe,[["__scopeId","data-v-f9175207"]]);export{Te as default};
