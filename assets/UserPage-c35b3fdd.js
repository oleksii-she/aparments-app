import{_ as F,ab as G,b as j,ac as z,d as f,u as M,r as V,q as I,e as S,o as n,c,a as e,t as d,h as C,m as _,y as T,v as y,x as A,f as P,g as H,ad as J,ae as K,j as O,af as Q,ag as R,ah as W,ai as X,p as Y,k as Z,A as ee,l as N}from"./index-0991e8e8.js";import{A as te}from"./AddRating-e693e420.js";const m=g=>(Y("data-v-787b0561"),g=g(),Z(),g),q=N+"#icon-edit",E=N+"#icon-confirm",se={class:"container user-page"},ae={class:"home-page__wrapper"},ne={class:"user-wrapper"},oe={key:0,class:"user"},re={class:"wrapper"},ie={key:0,class:"user__text-wrapper"},ce={class:"user__text"},_e=m(()=>e("svg",{class:"btn-edit__icon"},[e("use",{"xlink:href":q})],-1)),le=[_e],ue={key:1,class:"user__text-wrapper"},pe={class:"user__text"},de=["value"],he=m(()=>e("svg",{class:"btn-edit__icon"},[e("use",{"xlink:href":E})],-1)),me=[he],ge={class:"user__text-wrapper"},ve={class:"user__text"},fe={class:"wrapper"},ye={key:0,class:"user__text-wrapper"},xe={key:0,class:"user__text"},ke={key:1,class:"user__text"},we=m(()=>e("svg",{class:"btn-edit__icon"},[e("use",{"xlink:href":q})],-1)),be=[we],Ue={key:1,class:"user__text-wrapper"},Ve={class:"user__text"},Ie=["value"],Se=m(()=>e("svg",{class:"btn-edit__icon"},[e("use",{"xlink:href":E})],-1)),Ce=[Se],Ae={key:1,class:"user"},Pe={class:"wrapper"},Re={class:"user__text-wrapper"},Ne={class:"user__text"},qe={class:"user__text-wrapper"},Ee={class:"user__text"},Be={class:"user__text-wrapper"},De={class:"user__text"},$e={class:"user-rating-box"},Le=m(()=>e("h3",null,"User rating",-1)),Fe={__name:"UserPage",setup(g){const x=G(),B=j(),D=9,i=z(),p=f(parseInt(x.query.page)||1),u=M(),$=ee({position:"top"}),l=V({name:!1,phone:!1}),o=V({name:"",phone:""}),h=f({}),v=f(null),k=f(!1);I(async()=>{const{id:s}=u;B.push({query:{...x.query,page:p.value}});const t=x.params.id;if(t){v.value=t;const r=await i.fetchGetUser(t);await i.fetchUserApartments(t,p.value),r.usersRatings.find(L=>L.user===s)&&(k.value=!0);const a=Math.round(r.userRating);h.value={name:r.name,phone:r.phone,email:r.email,rating:a}}else if(i.fetchUserApartments(s,p.value),o.name=u.name,u.phone){const r=R(u.phone);o.phone=r}}),I(async()=>{try{await i.fetchGetUser(v.value)}catch(s){console.log(s.message)}});const w=s=>{if(s.target.name==="name"&&(o.name=s.target.value),s.target.name==="phone"){const t=s.target.value;/^\+38\(\d{3}\)\d{3}-\d{2}-\d{2}$/.test(t)&&(o.phone=s.target.value)}},b=async()=>{try{const s=O(o.phone),t=o.name,r={phone:s,name:t};await u.fetchUpdateUser(r),l.phone=!1,l.name=!1}catch(s){if(l.phone=!1,l.name=!1,s.request.status===400)return o.phone=u.phone,$.warning(s.request.response);console.log(s.message)}};return(s,t)=>{const r=S("URating"),U=S("ULoader");return n(),c("main",null,[e("section",null,[e("div",se,[e("div",ae,[e("div",ne,[v.value?(n(),c("div",Ae,[e("div",Pe,[e("div",Re,[e("p",Ne,"Name: "+d(h.value.name),1)]),e("div",qe,[e("p",Ee,"Email: "+d(h.value.email),1)]),e("div",Be,[e("p",De,"Phone: "+d(_(R)(h.value.phone)),1)])])])):(n(),c("div",oe,[e("div",re,[l.name?(n(),c("div",ue,[e("label",pe,[C(" і’мя: "),e("input",{class:"user__input-rename",name:"name",value:o.name,onChange:w},null,40,de)]),e("button",{onClick:b,class:"btn-edit"},me)])):(n(),c("div",ie,[e("p",ce,"і’мя: "+d(o.name),1),e("button",{onClick:t[0]||(t[0]=a=>l.name=!0),class:"btn-edit"},le)]))]),e("div",ge,[e("p",ve,"E-mail: "+d(_(u).email),1)]),e("div",fe,[l.phone?(n(),c("div",Ue,[e("label",Ve,[C(" Телефон: "),T(e("input",{ref:"phoneInput",class:"user__input-rename",type:"tel",name:"phone",value:o.phone,onChange:w},null,40,Ie),[[_(Q),{mask:"+38(0##)###-##-##"}]])]),e("button",{onClick:b,class:"btn-edit"},Ce)])):(n(),c("div",ye,[o.phone?(n(),c("p",xe,"Телефон: "+d(o.phone),1)):(n(),c("p",ke,"Телефон: +38(000)000-00-00")),e("button",{onClick:t[1]||(t[1]=a=>l.phone=!0),class:"btn-edit"},be)]))])])),e("div",$e,[Le,k.value?(n(),y(r,{key:0,width:50,height:50,rating:h.value.rating},null,8,["rating"])):(n(),y(te,{key:1,width:50,height:50,"onUpdate:isVote":t[2]||(t[2]=a=>k.value=a),ratingVote:_(W),id:v.value},null,8,["ratingVote","id"]))])]),e("div",null,[_(i).loading?(n(),y(U,{key:0,loading:!0})):A("",!0),P(J,{apartments:_(i).apartments},{apartment:H(a=>[P(X,{id:a.apartment._id,coverImage:a.apartment.coverImage,description:a.apartment.description,price:a.apartment.price,longStayPrice:a.apartment.longStayPrice,country:a.apartment.country,rating:a.apartment.rating},null,8,["id","coverImage","description","price","longStayPrice","country","rating"])]),_:1},8,["apartments"])])]),_(i).totalPosts>9&&!_(i).loading?(n(),y(K,{key:0,class:"paginate",modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=a=>p.value=a),perPage:D,rangeSize:1,"active-color":"#DCEDFF","onUpdate:value":t[4]||(t[4]=a=>p.value=a),totalPost:_(i).totalPosts},null,8,["modelValue","totalPost"])):A("",!0)])])])}}},ze=F(Fe,[["__scopeId","data-v-787b0561"]]);export{ze as default};
